<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carteira de Controle Financeiro</title>
  <style>
    :root {
      --amarelo-fundo: #fff9c4;
      --amarelo-principal: #fbc02d;
      --amarelo-escuro: #f9a825;
      --cinza-escuro: #333;
      --verde: #2e7d32;
      --vermelho: #c62828;
      --azul: #1565c0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: var(--amarelo-fundo);
      display: flex;
      justify-content: center;
    }

    .app-container {
      width: 100%;
      max-width: 900px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: #fff9c4;
    }

    .app-header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: linear-gradient(90deg, #fbc02d, #f9a825);
      color: var(--cinza-escuro);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .app-header span.icon {
      font-size: 1.4em;
    }

    .app-header h1 {
      font-size: 1.1em;
      margin: 0;
    }

    .app-main {
      flex: 1;
      padding: 16px;
      padding-bottom: 70px;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
    }

    small {
      font-size: 0.85em;
    }

    .error {
      color: red;
      font-size: 0.9em;
      display: none;
      margin-top: 2px;
    }

    .btn-submit {
      margin-top: 15px;
      padding: 10px 15px;
      background-color: var(--amarelo-principal);
      border: none;
      color: var(--cinza-escuro);
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
      width: 100%;
    }

    .btn-submit:hover {
      background-color: var(--amarelo-escuro);
    }

    /* DASHBOARD DE CARDS */
    .dashboard-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
    }

    .dash-card {
      flex: 1 1 150px;
      background: #fffde7;
      border-radius: 6px;
      border: 1px solid #f0e68c;
      padding: 8px 10px;
      font-size: 0.9em;
    }

    .dash-card-titulo {
      font-weight: bold;
      margin-bottom: 4px;
    }

    .dash-card-valor {
      font-size: 1.1em;
    }

    .dash-card.receita .dash-card-valor {
      color: var(--verde);
    }
    .dash-card.despesa .dash-card-valor {
      color: var(--vermelho);
    }
    .dash-card.poupanca .dash-card-valor {
      color: var(--azul);
    }
    .dash-card.sobra .dash-card-valor {
      color: #00695c;
    }

    /* BANNER DE ALERTA */
    .alerta-gasto {
      display: none;
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 4px;
      font-size: 0.9em;
      font-weight: bold;
      background-color: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
    }

    #lista-transacoes {
      margin-top: 25px;
    }

    #lista-transacoes h2,
    #lista-transacoes h3 {
      margin-top: 20px;
      margin-bottom: 8px;
    }

    #lista-transacoes ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #lista-transacoes li,
    #lista-poupanca li {
      background: #fffde7;
      border: 1px solid #f0e68c;
      border-radius: 4px;
      padding: 8px;
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.95em;
      gap: 8px;
    }

    #lista-transacoes li.receita {
      border-left: 4px solid var(--verde);
    }

    #lista-transacoes li.despesa {
      border-left: 4px solid var(--vermelho);
    }

    #lista-transacoes li.poupanca,
    #lista-poupanca li {
      border-left: 4px solid var(--azul);
    }

    .transacao-info {
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    .transacao-categoria {
      font-weight: bold;
    }

    .transacao-data {
      font-size: 0.8em;
      color: #777;
    }

    .transacao-valor {
      font-weight: bold;
      min-width: 90px;
      text-align: right;
    }
    .transacao-valor.receita {
      color: var(--verde);
    }
    .transacao-valor.despesa {
      color: var(--vermelho);
    }
    .transacao-valor.poupanca {
      color: var(--azul);
    }

    .transacao-acoes {
      display: flex;
      gap: 4px;
    }

    .btn-acao {
      border: none;
      padding: 4px 6px;
      font-size: 0.8em;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-editar {
      background-color: #e0f2f1;
      color: #00695c;
    }

    .btn-excluir {
      background-color: #ffebee;
      color: #c62828;
    }

    .resumos-container {
      display: flex;
      gap: 16px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .resumo-box {
      flex: 1 1 250px;
      padding: 10px;
      background: #fffde7;
      border-radius: 6px;
      border: 1px solid #f0e68c;
      font-size: 0.95em;
    }

    .resumo-box h2 {
      margin-top: 0;
      margin-bottom: 8px;
    }

    .resumo-box p {
      margin: 4px 0;
    }

    .resumo-box .linha-destaque {
      margin-top: 6px;
      padding: 6px 8px;
      border-radius: 4px;
      font-weight: bold;
    }

    .linha-positivo {
      background-color: #e8f5e9;
      color: var(--verde);
    }

    .linha-negativo {
      background-color: #ffebee;
      color: var(--vermelho);
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      max-width: 900px;
      width: 100%;
      background: #fffde7;
      border-top: 1px solid #f0e68c;
      display: flex;
      justify-content: space-around;
      padding: 6px 0;
      box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
    }

    .bottom-nav button {
      flex: 1;
      background: transparent;
      border: none;
      padding: 6px 0;
      font-size: 0.85em;
      color: #666;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      cursor: pointer;
    }

    .bottom-nav button span.icon {
      font-size: 1.1em;
    }

    .bottom-nav button.active {
      color: var(--cinza-escuro);
      font-weight: bold;
    }

    .status-ok {
      color: var(--verde);
      font-weight: bold;
    }
    .status-atencao {
      color: #ff9800;
      font-weight: bold;
    }
    .status-critico {
      color: var(--vermelho);
      font-weight: bold;
    }

    @media (max-width: 600px) {
      .app-main {
        padding: 12px;
        padding-bottom: 70px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <span class="icon">üí≥</span>
      <h1>Carteira de Controle Financeiro</h1>
    </header>

    <main class="app-main">
      <!-- TELA 1: LAN√áAR -->
      <section id="screen-lancar" class="screen active">
        <h2>Lan√ßar transa√ß√£o</h2>

        <label for="salario-mensal">Sal√°rio mensal (R$):</label>
        <input type="number" id="salario-mensal" step="0.01" min="0" placeholder="Sal√°rio: 2500.00" />
        <small>Este valor ser√° considerado no relat√≥rio e no resumo de gasto.</small>

        <form id="finance-form" novalidate>
          <input type="hidden" id="indice-edicao" value="-1" />

          <label for="tipo">Tipo:</label>
          <select id="tipo" name="tipo" required>
            <option value="">Selecione</option>
            <option value="receita">Receita</option>
            <option value="despesa_fixa_essencial">Despesa Fixa Essencial</option>
            <option value="despesa_variavel_essencial">Despesa Vari√°vel Essencial</option>
            <option value="despesa_nao_essencial">Despesa N√£o Essencial (Lazer)</option>
            <option value="investimento_divida">Investimentos e D√≠vidas</option>
            <option value="poupanca">Poupan√ßa</option>
          </select>
          <span class="error" id="tipo-error">Por favor, selecione o tipo.</span>

          <small>
            Exemplos:<br>
            ‚Ä¢ Despesa Fixa Essencial: Moradia, servi√ßos p√∫blicos, conv√™nio, escola, empr√©stimos.<br>
            ‚Ä¢ Despesa Vari√°vel Essencial: Alimenta√ß√£o, combust√≠vel, rem√©dios, higiene, vestu√°rio.<br>
            ‚Ä¢ Despesa N√£o Essencial: restaurantes, viagens, streaming, presentes.<br>
            ‚Ä¢ Investimentos e D√≠vidas: investimentos, cart√£o de cr√©dito, amortiza√ß√£o.<br>
            ‚Ä¢ Poupan√ßa: valores reservados para guardar.
          </small>

          <label for="valor">Valor (R$):</label>
          <input type="number" id="valor" name="valor" step="0.01" min="0.01" placeholder="Ex: 150.00" required />
          <span class="error" id="valor-error">Informe um valor maior que zero.</span>

          <label for="data">Data:</label>
          <input type="date" id="data" name="data" required />
          <span class="error" id="data-error">Informe uma data v√°lida.</span>

          <label for="categoria">Categoria:</label>
          <input type="text" id="categoria" name="categoria" placeholder="Ex: Aluguel, Luz, Supermercado, Netflix" required />
          <span class="error" id="categoria-error">Categoria √© obrigat√≥ria.</span>

          <label for="descricao">Descri√ß√£o:</label>
          <textarea id="descricao" name="descricao" rows="3" placeholder="Descri√ß√£o opcional"></textarea>

          <button type="submit" class="btn-submit">Salvar transa√ß√£o</button>
        </form>
      </section>

      <!-- TELA 2: CARTEIRA -->
      <section id="screen-carteira" class="screen">
        <h2>Carteira</h2>

        <!-- BANNER DE ALERTA -->
        <div id="alerta-gasto" class="alerta-gasto">
          Aten√ß√£o: voc√™ j√° utilizou mais de 80% do sal√°rio deste m√™s.
        </div>

        <!-- DASHBOARD -->
        <div class="dashboard-cards">
          <div class="dash-card receita">
            <div class="dash-card-titulo">Receitas</div>
            <div class="dash-card-valor" id="card-receitas">R$ 0,00</div>
          </div>
          <div class="dash-card despesa">
            <div class="dash-card-titulo">Despesas</div>
            <div class="dash-card-valor" id="card-despesas">R$ 0,00</div>
          </div>
          <div class="dash-card poupanca">
            <div class="dash-card-titulo">Poupan√ßa</div>
            <div class="dash-card-valor" id="card-poupanca">R$ 0,00</div>
          </div>
          <div class="dash-card sobra">
            <div class="dash-card-titulo">Sobra do sal√°rio</div>
            <div class="dash-card-valor" id="card-sobra-salario">R$ 0,00</div>
          </div>
        </div>

        <section id="lista-transacoes">
          <h3>Transa√ß√µes da Carteira</h3>
          <ul id="transacoes"></ul>
        </section>

        <div class="resumos-container">
          <!-- RELAT√ìRIO DO M√äS -->
          <section class="resumo-box" id="relatorio-mes">
            <h2>Relat√≥rio do M√™s</h2>

            <p><strong>Sal√°rio mensal informado:</strong> <span id="salario-informado">R$ 0,00</span></p>
            <p><strong>Total de Receitas:</strong> <span id="total-receitas">R$ 0,00</span></p>
            <p><strong>Total de Despesas (soma de todas as despesas):</strong> <span id="total-despesas">R$ 0,00</span></p>
            <p><strong>Poupan√ßa (total guardado):</strong> <span id="total-poupanca">R$ 0,00</span></p>
            <p><strong>Total que saiu do bolso (despesas + poupan√ßa):</strong> <span id="total-gasto-mes">R$ 0,00</span></p>

            <p class="linha-destaque linha-positivo">
              Saldo do m√™s (receitas ‚àí despesas): <span id="saldo">R$ 0,00</span>
            </p>
          </section>

          <!-- RESUMO DE GASTO EM CIMA DO SAL√ÅRIO -->
          <section class="resumo-box" id="resumo-gasto">
            <h2>Resumo de Gasto</h2>

            <p><strong>Sal√°rio mensal informado:</strong> <span id="salario-informado-2">R$ 0,00</span></p>
            <p><strong>Total Gasto (despesas + poupan√ßa):</strong> <span id="total-gasto">R$ 0,00</span></p>
            <p><strong>Sobra do Sal√°rio:</strong> <span id="sobra-salario">R$ 0,00</span></p>
            <p><strong>Percentual gasto do sal√°rio:</strong> <span id="percentual-gasto">0,0%</span></p>
            <p><strong>Situa√ß√£o:</strong> <span id="situacao-gasto" class="status-ok">Informe o sal√°rio</span></p>
          </section>
        </div>
      </section>

      <!-- TELA 3: POUPAN√áA -->
      <section id="screen-poupanca" class="screen">
        <h2>Poupan√ßa</h2>

        <section class="resumo-box" id="resumo-poupanca">
          <h2>Resumo de Poupan√ßa</h2>
          <p><strong>Valor adicionado (√∫ltima opera√ß√£o):</strong> <span id="valor-adicionado-poupanca">R$ 0,00</span></p>
          <p><strong>Total de poupan√ßa:</strong> <span id="total-poupanca-2">R$ 0,00</span></p>
        </section>

        <section id="lista-poupanca">
          <h3>Lan√ßamentos de Poupan√ßa</h3>
          <ul id="poupanca-lancamentos"></ul>
        </section>
      </section>
    </main>

    <nav class="bottom-nav">
      <button data-target="screen-lancar" class="active">
        <span class="icon">‚ûï</span>
        <span>Lan√ßar</span>
      </button>
      <button data-target="screen-carteira">
        <span class="icon">üìã</span>
        <span>Carteira</span>
      </button>
      <button data-target="screen-poupanca">
        <span class="icon">üí∞</span>
        <span>Poupan√ßa</span>
      </button>
    </nav>
  </div>

  <script>
    let salarioMensal = 0;
    let totalPoupanca = 0;
    let ultimoValorPoupanca = 0;
    let transacoes = [];
    let indiceEdicao = -1;

    const navButtons = document.querySelectorAll('.bottom-nav button');
    const screens = document.querySelectorAll('.screen');

    navButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-target');
        screens.forEach(sc => sc.classList.toggle('active', sc.id === target));
        navButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    document.getElementById('salario-mensal').addEventListener('change', function () {
      const v = parseFloat(this.value);
      salarioMensal = isNaN(v) || v < 0 ? 0 : v;
      document.getElementById('salario-informado').textContent = `R$ ${salarioMensal.toFixed(2)}`;
      document.getElementById('salario-informado-2').textContent = `R$ ${salarioMensal.toFixed(2)}`;
      salvarEstado();
      atualizarResumo();
    });

    document.getElementById('finance-form').addEventListener('submit', function(event) {
      event.preventDefault();

      let formIsValid = true;

      const tipo = document.getElementById('tipo');
      const tipoError = document.getElementById('tipo-error');
      if (tipo.value === '') {
        tipoError.style.display = 'block';
        formIsValid = false;
      } else {
        tipoError.style.display = 'none';
      }

      const valor = document.getElementById('valor');
      const valorError = document.getElementById('valor-error');
      if (valor.value === '' || parseFloat(valor.value) <= 0) {
        valorError.style.display = 'block';
        formIsValid = false;
      } else {
        valorError.style.display = 'none';
      }

      const data = document.getElementById('data');
      const dataError = document.getElementById('data-error');
      if (data.value === '') {
        dataError.style.display = 'block';
        formIsValid = false;
      } else {
        dataError.style.display = 'none';
      }

      const categoria = document.getElementById('categoria');
      const categoriaError = document.getElementById('categoria-error');
      if (categoria.value.trim() === '') {
        categoriaError.style.display = 'block';
        formIsValid = false;
      } else {
        categoriaError.style.display = 'none';
      }

      if (!formIsValid) return;

      const valorNumero = parseFloat(valor.value);

      const dados = {
        tipo: tipo.value,
        valor: valorNumero,
        data: data.value,
        categoria: categoria.value.trim(),
        descricao: document.getElementById('descricao').value.trim()
      };

      // Ajuste de total de poupan√ßa
      if (dados.tipo === 'poupanca') {
        const valorAntigo = indiceEdicao >= 0 && transacoes[indiceEdicao].tipo === 'poupanca'
          ? transacoes[indiceEdicao].valor
          : 0;

        totalPoupanca = totalPoupanca - valorAntigo + valorNumero;
        ultimoValorPoupanca = valorNumero;
        document.getElementById('valor-adicionado-poupanca').textContent = `R$ ${ultimoValorPoupanca.toFixed(2)}`;
        document.getElementById('total-poupanca').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
        document.getElementById('total-poupanca-2').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
      } else if (indiceEdicao >= 0 && transacoes[indiceEdicao].tipo === 'poupanca') {
        totalPoupanca -= transacoes[indiceEdicao].valor;
        if (totalPoupanca < 0) totalPoupanca = 0;
        document.getElementById('total-poupanca').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
        document.getElementById('total-poupanca-2').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
      }

      if (indiceEdicao === -1) {
        transacoes.push(dados);
      } else {
        transacoes[indiceEdicao] = dados;
      }

      renderizarTransacoes();
      renderizarPoupancaLancamentos();
      salvarEstado();
      atualizarResumo();

      alert(indiceEdicao === -1 ? 'Transa√ß√£o adicionada com sucesso.' : 'Transa√ß√£o atualizada com sucesso.');

      this.reset();
      indiceEdicao = -1;
      document.getElementById('indice-edicao').value = -1;
    });

    function renderizarTransacoes() {
      const lista = document.getElementById('transacoes');
      lista.innerHTML = '';

      transacoes.forEach((dados, indice) => {
        const li = document.createElement('li');

        if (dados.tipo === 'receita') {
          li.classList.add('receita');
        } else if (dados.tipo === 'poupanca') {
          li.classList.add('poupanca');
        } else {
          li.classList.add('despesa');
        }

        const info = document.createElement('div');
        info.className = 'transacao-info';

        const catSpan = document.createElement('span');
        catSpan.className = 'transacao-categoria';
        catSpan.textContent = dados.categoria;

        const dataSpan = document.createElement('span');
        dataSpan.className = 'transacao-data';
        dataSpan.textContent = dados.data + (dados.descricao ? ' ‚Ä¢ ' + dados.descricao : '');

        info.appendChild(catSpan);
        info.appendChild(dataSpan);

        const valorSpan = document.createElement('span');
        valorSpan.className = 'transacao-valor';
        if (dados.tipo === 'receita') {
          valorSpan.classList.add('receita');
        } else if (dados.tipo === 'poupanca') {
          valorSpan.classList.add('poupanca');
        } else {
          valorSpan.classList.add('despesa');
        }
        valorSpan.textContent = `R$ ${dados.valor.toFixed(2)}`;

        const acoes = document.createElement('div');
        acoes.className = 'transacao-acoes';

        const btnEditar = document.createElement('button');
        btnEditar.textContent = 'Editar';
        btnEditar.className = 'btn-acao btn-editar';
        btnEditar.addEventListener('click', () => editarTransacao(indice));

        const btnExcluir = document.createElement('button');
        btnExcluir.textContent = 'Excluir';
        btnExcluir.className = 'btn-acao btn-excluir';
        btnExcluir.addEventListener('click', () => excluirTransacao(indice));

        acoes.appendChild(btnEditar);
        acoes.appendChild(btnExcluir);

        li.appendChild(info);
        li.appendChild(valorSpan);
        li.appendChild(acoes);

        lista.appendChild(li);
      });
    }

    function renderizarPoupancaLancamentos() {
      const lista = document.getElementById('poupanca-lancamentos');
      lista.innerHTML = '';

      transacoes.forEach((dados, indice) => {
        if (dados.tipo !== 'poupanca') return;

        const li = document.createElement('li');

        const info = document.createElement('div');
        info.className = 'transacao-info';

        const catSpan = document.createElement('span');
        catSpan.className = 'transacao-categoria';
        catSpan.textContent = dados.categoria;

        const dataSpan = document.createElement('span');
        dataSpan.className = 'transacao-data';
        dataSpan.textContent = dados.data + (dados.descricao ? ' ‚Ä¢ ' + dados.descricao : '');

        info.appendChild(catSpan);
        info.appendChild(dataSpan);

        const valorSpan = document.createElement('span');
        valorSpan.className = 'transacao-valor poupanca';
        valorSpan.textContent = `R$ ${dados.valor.toFixed(2)}`;

        const acoes = document.createElement('div');
        acoes.className = 'transacao-acoes';

        const btnEditar = document.createElement('button');
        btnEditar.textContent = 'Editar';
        btnEditar.className = 'btn-acao btn-editar';
        btnEditar.addEventListener('click', () => editarTransacao(indice));

        const btnExcluir = document.createElement('button');
        btnExcluir.textContent = 'Excluir';
        btnExcluir.className = 'btn-acao btn-excluir';
        btnExcluir.addEventListener('click', () => excluirTransacao(indice));

        acoes.appendChild(btnEditar);
        acoes.appendChild(btnExcluir);

        li.appendChild(info);
        li.appendChild(valorSpan);
        li.appendChild(acoes);

        lista.appendChild(li);
      });
    }

    function editarTransacao(indice) {
      const t = transacoes[indice];
      indiceEdicao = indice;
      document.getElementById('indice-edicao').value = indice;

      document.getElementById('tipo').value = t.tipo;
      document.getElementById('valor').value = t.valor;
      document.getElementById('data').value = t.data;
      document.getElementById('categoria').value = t.categoria;
      document.getElementById('descricao').value = t.descricao;

      screens.forEach(sc => sc.classList.toggle('active', sc.id === 'screen-lancar'));
      navButtons.forEach(b => b.classList.remove('active'));
      document.querySelector('button[data-target="screen-lancar"]').classList.add('active');
    }

    function excluirTransacao(indice) {
      const t = transacoes[indice];

      if (t.tipo === 'poupanca') {
        totalPoupanca -= t.valor;
        if (totalPoupanca < 0) totalPoupanca = 0;
        document.getElementById('total-poupanca').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
        document.getElementById('total-poupanca-2').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
      }

      transacoes.splice(indice, 1);
      renderizarTransacoes();
      renderizarPoupancaLancamentos();
      salvarEstado();
      atualizarResumo();
    }

    // RELAT√ìRIO DO M√äS + RESUMO DE GASTO
    function atualizarResumo() {
      const itens = document.querySelectorAll('#transacoes li');
      let totalReceitas = 0;
      let totalDespesas = 0;
      let totalPoupancaGasto = 0;

      itens.forEach(li => {
        const valorTexto = li.querySelector('.transacao-valor').textContent.replace('R$','').trim();
        const valor = parseFloat(valorTexto.replace(',', '.')) || 0;

        if (li.classList.contains('receita')) {
          totalReceitas += valor;
        } else if (li.classList.contains('despesa')) {
          totalDespesas += valor;
        } else if (li.classList.contains('poupanca')) {
          totalPoupancaGasto += valor;
        }
      });

      const saldo = totalReceitas - totalDespesas;
      const totalGastoMes = totalDespesas;              // s√≥ despesas
      const totalGastoSalario = totalDespesas + totalPoupancaGasto; // despesas + poupan√ßa
      const sobraSalario = salarioMensal - totalGastoSalario;

      // Relat√≥rio do m√™s
      document.getElementById('total-receitas').textContent = `R$ ${totalReceitas.toFixed(2)}`;
      document.getElementById('total-despesas').textContent = `R$ ${totalDespesas.toFixed(2)}`;
      document.getElementById('saldo').textContent = `R$ ${saldo.toFixed(2)}`;
      document.getElementById('total-poupanca').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
      document.getElementById('total-poupanca-2').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
      document.getElementById('total-gasto-mes').textContent = `R$ ${totalGastoSalario.toFixed(2)}`;

      // Resumo de gasto em cima do sal√°rio
      document.getElementById('total-gasto').textContent = `R$ ${totalGastoSalario.toFixed(2)}`;
      document.getElementById('sobra-salario').textContent = `R$ ${sobraSalario.toFixed(2)}`;

      // Atualiza cards do dashboard
      document.getElementById('card-receitas').textContent = `R$ ${totalReceitas.toFixed(2)}`;
      document.getElementById('card-despesas').textContent = `R$ ${totalDespesas.toFixed(2)}`;
      document.getElementById('card-poupanca').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
      document.getElementById('card-sobra-salario').textContent = `R$ ${sobraSalario.toFixed(2)}`;

      let percentual = 0;
      if (salarioMensal > 0) {
        percentual = (totalGastoSalario / salarioMensal) * 100;
      }
      const percentualEl = document.getElementById('percentual-gasto');
      const situacaoEl = document.getElementById('situacao-gasto');
      const alertaGasto = document.getElementById('alerta-gasto');

      percentualEl.textContent = `${percentual.toFixed(1)}%`;

      situacaoEl.classList.remove('status-ok', 'status-atencao', 'status-critico');

      if (salarioMensal <= 0) {
        situacaoEl.textContent = 'Informe o sal√°rio';
        situacaoEl.classList.add('status-critico');
        alertaGasto.style.display = 'none';
      } else if (percentual <= 50) {
        situacaoEl.textContent = 'OK';
        situacaoEl.classList.add('status-ok');
        alertaGasto.style.display = 'none';
      } else if (percentual <= 80) {
        situacaoEl.textContent = 'Aten√ß√£o';
        situacaoEl.classList.add('status-atencao');
        alertaGasto.style.display = 'none';
      } else {
        situacaoEl.textContent = 'Cr√≠tico';
        situacaoEl.classList.add('status-critico');
        alertaGasto.style.display = 'block';
      }
    }

    function salvarEstado() {
      const estado = {
        salarioMensal,
        totalPoupanca,
        ultimoValorPoupanca,
        transacoes
      };
      localStorage.setItem('carteiraFinanceira', JSON.stringify(estado));
    }

    function carregarEstado() {
      const salvo = localStorage.getItem('carteiraFinanceira');
      if (!salvo) return;

      try {
        const estado = JSON.parse(salvo);
        salarioMensal = estado.salarioMensal || 0;
        totalPoupanca = estado.totalPoupanca || 0;
        ultimoValorPoupanca = estado.ultimoValorPoupanca || 0;
        transacoes = Array.isArray(estado.transacoes) ? estado.transacoes : [];

        document.getElementById('salario-mensal').value = salarioMensal || '';
        document.getElementById('salario-informado').textContent = `R$ ${salarioMensal.toFixed(2)}`;
        document.getElementById('salario-informado-2').textContent = `R$ ${salarioMensal.toFixed(2)}`;
        document.getElementById('valor-adicionado-poupanca').textContent = `R$ ${ultimoValorPoupanca.toFixed(2)}`;
        document.getElementById('total-poupanca').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
        document.getElementById('total-poupanca-2').textContent = `R$ ${totalPoupanca.toFixed(2)}`;

        renderizarTransacoes();
        renderizarPoupancaLancamentos();
        atualizarResumo();
      } catch (e) {
        console.error('Erro ao carregar estado da carteira:', e);
      }
    }

    carregarEstado();
  </script>
</body>
</html>
