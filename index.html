<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carteira de Controle Financeiro</title>
  <style>
    :root {
      --amarelo-fundo: #fff9c4;
      --amarelo-principal: #fbc02d;
      --amarelo-escuro: #f9a825;
      --cinza-escuro: #333;
      --verde: #2e7d32;
      --vermelho: #c62828;
      --azul: #1565c0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: var(--amarelo-fundo);
      display: flex;
      justify-content: center;
    }

    .app-container {
      width: 100%;
      max-width: 900px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background-color: #fff9c4;
    }

    /* Barra superior tipo app */
    .app-header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: linear-gradient(90deg, #fbc02d, #f9a825);
      color: var(--cinza-escuro);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .app-header span.icon {
      font-size: 1.4em;
    }

    .app-header h1 {
      font-size: 1.1em;
      margin: 0;
    }

    .app-main {
      flex: 1;
      padding: 16px;
      padding-bottom: 70px; /* espa√ßo para a barra inferior */
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
    }

    small {
      font-size: 0.85em;
    }

    .error {
      color: red;
      font-size: 0.9em;
      display: none;
      margin-top: 2px;
    }

    .btn-submit {
      margin-top: 15px;
      padding: 10px 15px;
      background-color: var(--amarelo-principal);
      border: none;
      color: var(--cinza-escuro);
      cursor: pointer;
      font-weight: bold;
      border-radius: 4px;
      width: 100%;
    }

    .btn-submit:hover {
      background-color: var(--amarelo-escuro);
    }

    #lista-transacoes {
      margin-top: 25px;
    }

    #lista-transacoes h2 {
      margin-top: 20px;
      margin-bottom: 8px;
    }

    #lista-transacoes ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #lista-transacoes li {
      background: #fffde7;
      border: 1px solid #f0e68c;
      border-radius: 4px;
      padding: 8px;
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      font-size: 0.95em;
    }

    #lista-transacoes li.receita {
      border-left: 4px solid var(--verde);
    }

    #lista-transacoes li.despesa {
      border-left: 4px solid var(--vermelho);
    }

    #lista-transacoes li.poupanca {
      border-left: 4px solid var(--azul);
    }

    /* Resumos lado a lado */
    .resumos-container {
      display: flex;
      gap: 16px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .resumo-box {
      flex: 1 1 250px;
      padding: 10px;
      background: #fffde7;
      border-radius: 4px;
      border: 1px solid #f0e68c;
      font-size: 0.95em;
    }

    .resumo-box h2 {
      margin-top: 0;
      margin-bottom: 8px;
    }

    .resumo-box p {
      margin: 4px 0;
    }

    /* Telas (abas) */
    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    /* Barra inferior tipo navega√ß√£o de app */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      max-width: 900px;
      width: 100%;
      background: #fffde7;
      border-top: 1px solid #f0e68c;
      display: flex;
      justify-content: space-around;
      padding: 6px 0;
      box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
    }

    .bottom-nav button {
      flex: 1;
      background: transparent;
      border: none;
      padding: 6px 0;
      font-size: 0.85em;
      color: #666;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      cursor: pointer;
    }

    .bottom-nav button span.icon {
      font-size: 1.1em;
    }

    .bottom-nav button.active {
      color: var(--cinza-escuro);
      font-weight: bold;
    }

    @media (max-width: 600px) {
      .app-main {
        padding: 12px;
        padding-bottom: 70px;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Cabe√ßalho tipo app -->
    <header class="app-header">
      <span class="icon">üí≥</span>
      <h1>Carteira de Controle Financeiro</h1>
    </header>

    <main class="app-main">
      <!-- TELA 1: LAN√áAR -->
      <section id="screen-lancar" class="screen active">
        <h2>Lan√ßar transa√ß√£o</h2>

        <!-- Campo para armazenar o sal√°rio mensal -->
        <label for="salario-mensal">Sal√°rio mensal (R$):</label>
        <input type="number" id="salario-mensal" step="0.01" min="0" placeholder="Sal√°rio: 2500.00" />
        <small>Este valor ser√° considerado no resumo como refer√™ncia de renda.</small>

        <form id="finance-form" novalidate>
          <label for="tipo">Tipo:</label>
          <select id="tipo" name="tipo" required>
            <option value="">Selecione</option>
            <option value="receita">Receita</option>

            <!-- Tipos de despesas -->
            <option value="despesa_fixa_essencial">Despesa Fixa Essencial</option>
            <option value="despesa_variavel_essencial">Despesa Vari√°vel Essencial</option>
            <option value="despesa_nao_essencial">Despesa N√£o Essencial (Lazer)</option>
            <option value="investimento_divida">Investimentos e D√≠vidas</option>

            <!-- Novo tipo: Poupan√ßa -->
            <option value="poupanca">Poupan√ßa</option>
          </select>
          <span class="error" id="tipo-error">Por favor, selecione o tipo.</span>

          <small>
            Exemplos:<br>
            ‚Ä¢ Despesa Fixa Essencial: Moradia, servi√ßos p√∫blicos, conv√™nio, escola, empr√©stimos.<br>
            ‚Ä¢ Despesa Vari√°vel Essencial: Alimenta√ß√£o, combust√≠vel, rem√©dios, higiene, vestu√°rio.<br>
            ‚Ä¢ Despesa N√£o Essencial: restaurantes, viagens, streaming, presentes.<br>
            ‚Ä¢ Investimentos e D√≠vidas: poupan√ßa, investimentos, cart√£o de cr√©dito, amortiza√ß√£o.<br>
            ‚Ä¢ Poupan√ßa: valores reservados para guardar.
          </small>

          <label for="valor">Valor (R$):</label>
          <input type="number" id="valor" name="valor" step="0.01" min="0.01" placeholder="Ex: 150.00" required />
          <span class="error" id="valor-error">Informe um valor maior que zero.</span>

          <label for="data">Data:</label>
          <input type="date" id="data" name="data" required />
          <span class="error" id="data-error">Informe uma data v√°lida.</span>

          <label for="categoria">Categoria:</label>
          <input type="text" id="categoria" name="categoria" placeholder="Ex: Aluguel, Luz, Supermercado, Netflix" required />
          <span class="error" id="categoria-error">Categoria √© obrigat√≥ria.</span>

          <label for="descricao">Descri√ß√£o:</label>
          <textarea id="descricao" name="descricao" rows="3" placeholder="Descri√ß√£o opcional"></textarea>

          <button type="submit" class="btn-submit">Adicionar √† Carteira</button>
        </form>
      </section>

      <!-- TELA 2: CARTEIRA (lista + resumos) -->
      <section id="screen-carteira" class="screen">
        <h2>Carteira</h2>

        <section id="lista-transacoes">
          <h3>Transa√ß√µes da Carteira</h3>
          <ul id="transacoes"></ul>
        </section>

        <!-- Resumos lado a lado -->
        <div class="resumos-container">
          <section class="resumo-box" id="resumo-principal">
            <h2>Resumo</h2>
            <p><strong>Total de Receitas:</strong> <span id="total-receitas">R$ 0,00</span></p>
            <p><strong>Total de Despesas:</strong> <span id="total-despesas">R$ 0,00</span></p>
            <p><strong>Saldo (Receitas - Despesas):</strong> <span id="saldo">R$ 0,00</span></p>
          </section>

          <section class="resumo-box" id="resumo-gasto">
            <h2>Resumo de Gasto</h2>
            <p><strong>Sal√°rio mensal informado:</strong> <span id="salario-informado">R$ 0,00</span></p>
            <p><strong>Total Gasto:</strong> <span id="total-gasto">R$ 0,00</span></p>
            <p><strong>Sobra do Sal√°rio:</strong> <span id="sobra-salario">R$ 0,00</span></p>
          </section>
        </div>
      </section>

      <!-- TELA 3: POUPAN√áA -->
      <section id="screen-poupanca" class="screen">
        <h2>Poupan√ßa</h2>
        <section class="resumo-box" id="resumo-poupanca">
          <h2>Resumo de Poupan√ßa</h2>
          <p><strong>Valor adicionado (√∫ltima opera√ß√£o):</strong> <span id="valor-adicionado-poupanca">R$ 0,00</span></p>
          <p><strong>Total de poupan√ßa:</strong> <span id="total-poupanca">R$ 0,00</span></p>
        </section>
      </section>
    </main>

    <!-- Barra inferior de navega√ß√£o -->
    <nav class="bottom-nav">
      <button data-target="screen-lancar" class="active">
        <span class="icon">‚ûï</span>
        <span>Lan√ßar</span>
      </button>
      <button data-target="screen-carteira">
        <span class="icon">üìã</span>
        <span>Carteira</span>
      </button>
      <button data-target="screen-poupanca">
        <span class="icon">üí∞</span>
        <span>Poupan√ßa</span>
      </button>
    </nav>
  </div>

  <script>
    let salarioMensal = 0;
    let totalPoupanca = 0;
    let ultimoValorPoupanca = 0;
    let transacoes = [];

    // -------- Navega√ß√£o entre telas --------
    const navButtons = document.querySelectorAll('.bottom-nav button');
    const screens = document.querySelectorAll('.screen');

    navButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-target');

        screens.forEach(sc => {
          sc.classList.toggle('active', sc.id === target);
        });

        navButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // --------- Sal√°rio mensal ---------
    document.getElementById('salario-mensal').addEventListener('change', function () {
      const v = parseFloat(this.value);
      salarioMensal = isNaN(v) || v < 0 ? 0 : v;
      document.getElementById('salario-informado').textContent = `R$ ${salarioMensal.toFixed(2)}`;
      salvarEstado();
      atualizarResumo();
    });

    // --------- Formul√°rio ---------
    document.getElementById('finance-form').addEventListener('submit', function(event) {
      event.preventDefault();

      let formIsValid = true;

      const tipo = document.getElementById('tipo');
      const tipoError = document.getElementById('tipo-error');
      if (tipo.value === '') {
        tipoError.style.display = 'block';
        formIsValid = false;
      } else {
        tipoError.style.display = 'none';
      }

      const valor = document.getElementById('valor');
      const valorError = document.getElementById('valor-error');
      if (valor.value === '' || parseFloat(valor.value) <= 0) {
        valorError.style.display = 'block';
        formIsValid = false;
      } else {
        valorError.style.display = 'none';
      }

      const data = document.getElementById('data');
      const dataError = document.getElementById('data-error');
      if (data.value === '') {
        dataError.style.display = 'block';
        formIsValid = false;
      } else {
        dataError.style.display = 'none';
      }

      const categoria = document.getElementById('categoria');
      const categoriaError = document.getElementById('categoria-error');
      if (categoria.value.trim() === '') {
        categoriaError.style.display = 'block';
        formIsValid = false;
      } else {
        categoriaError.style.display = 'none';
      }

      if (formIsValid) {
        const valorNumero = parseFloat(valor.value);

        const dados = {
          tipo: tipo.value,
          valor: valorNumero,
          data: data.value,
          categoria: categoria.value.trim(),
          descricao: document.getElementById('descricao').value.trim()
        };

        // Atualiza controle de poupan√ßa se o tipo for poupan√ßa
        if (dados.tipo === 'poupanca') {
          ultimoValorPoupanca = valorNumero;
          totalPoupanca += valorNumero;
          document.getElementById('valor-adicionado-poupanca').textContent = `R$ ${ultimoValorPoupanca.toFixed(2)}`;
          document.getElementById('total-poupanca').textContent = `R$ ${totalPoupanca.toFixed(2)}`;
        }

        transacoes.push(dados);
        adicionarTransacaoNaCarteira(dados);
        salvarEstado();
        atualizarResumo();

        alert('Dados validados com sucesso e adicionados √† carteira.');

        this.reset();
      }
    });

    function adicionarTransacaoNaCarteira(dados) {
      const lista = document.getElementById('transacoes');
      const li = document.createElement('li');

      // Visual: receita em verde, poupan√ßa em azul, resto como despesa
      if (dados.tipo === 'receita') {
        li.classList.add('receita');
      } else if (dados.tipo === 'poupanca') {
        li.classList.add('poupanca');
      } else {
        li.classList.add('despesa');
      }

      const textoLeft = document.createElement('span');
      textoLeft.textContent = `${dados.data} - ${dados.categoria}${dados.descricao ? ' - ' + dados.descricao : ''}`;

      const textoRight = document.createElement('span');
      textoRight.textContent = `R$ ${dados.valor.toFixed(2)}`;

      li.appendChild(textoLeft);
      li.appendChild(textoRight);

      lista.appendChild(li);
    }

    function atualizarResumo() {
      const itens = document.querySelectorAll('#transacoes li');
      let totalReceitas = 0;
      let totalDespesas = 0;

      itens.forEach(li => {
        const valorTexto = li.querySelector('span:last-child').textContent.replace('R$','').trim();
        const valor = parseFloat(valorTexto.replace(',', '.')) || 0;

        if (li.classList.contains('receita')) {
          totalReceitas += valor;
        } else if (li.classList.contains('despesa')) {
          totalDespesas += valor;
        }
        // Poupan√ßa n√£o entra em receitas nem em despesas aqui
      });

      const saldo = totalReceitas - totalDespesas;
      const totalGasto = totalDespesas;
      const sobraSalario = salarioMensal - totalGasto;

      // Resumo principal
      document.getElementById('total-receitas').textContent = `R$ ${totalReceitas.toFixed(2)}`;
      document.getElementById('total-despesas').textContent = `R$ ${totalDespesas.toFixed(2)}`;
      document.getElementById('saldo').textContent = `R$ ${saldo.toFixed(2)}`;

      // Resumo de gasto
      document.getElementById('total-gasto').textContent = `R$ ${totalGasto.toFixed(2)}`;
      document.getElementById('sobra-salario').textContent = `R$ ${sobraSalario.toFixed(2)}`;
    }

    // --------- Persist√™ncia no localStorage ---------
    function salvarEstado() {
      const estado = {
        salarioMensal,
        totalPoupanca,
        ultimoValorPoupanca,
        transacoes
      };
      localStorage.setItem('carteiraFinanceira', JSON.stringify(estado));
    }

    function carregarEstado() {
      const salvo = localStorage.getItem('carteiraFinanceira');
      if (!salvo) return;

      try {
        const estado = JSON.parse(salvo);
        salarioMensal = estado.salarioMensal || 0;
        totalPoupanca = estado.totalPoupanca || 0;
        ultimoValorPoupanca = estado.ultimoValorPoupanca || 0;
        transacoes = Array.isArray(estado.transacoes) ? estado.transacoes : [];

        // Atualiza campos visuais
        document.getElementById('salario-mensal').value = salarioMensal || '';
        document.getElementById('salario-informado').textContent = `R$ ${salarioMensal.toFixed(2)}`;
        document.getElementById('valor-adicionado-poupanca').textContent = `R$ ${ultimoValorPoupanca.toFixed(2)}`;
        document.getElementById('total-poupanca').textContent = `R$ ${totalPoupanca.toFixed(2)}`;

        // Recria lista de transa√ß√µes
        const lista = document.getElementById('transacoes');
        lista.innerHTML = '';
        transacoes.forEach(t => adicionarTransacaoNaCarteira(t));

        atualizarResumo();
      } catch (e) {
        console.error('Erro ao carregar estado da carteira:', e);
      }
    }

    // Carrega estado ao abrir a p√°gina
    carregarEstado();
  </script>
</body>
</html>
